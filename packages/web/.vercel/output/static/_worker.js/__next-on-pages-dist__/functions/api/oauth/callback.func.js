var K=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var Z=(s,i)=>()=>(s&&(i=s(s=0)),i);var G=(s,i,F,p)=>{if(i&&typeof i=="object"||typeof i=="function")for(let k of Q(i))!Y.call(s,k)&&k!==F&&K(s,k,{get:()=>i[k],enumerable:!(p=z(i,k))||p.enumerable});return s},X=(s,i,F)=>(G(s,i,"default"),F&&G(F,i,"default"));var ee=s=>G(K({},"__esModule",{value:!0}),s);var U={};import*as ze from"async_hooks";var H=Z(()=>{X(U,ze)});import{__getNamedExports as te}from"../../../../__next-on-pages-dist__/webpack/bdec9f97dc450b9d877b52222a283bc1.js";import{__getNamedExports as ne}from"../../../../__next-on-pages-dist__/manifest/537259e2ed205f5a7994cb4f05664668.js";var T=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/oauth/callback"),t=te(T,T,T),_e=t.__chunk_195,ce=t.__chunk_67,re=t.__chunk_388,oe=t.__chunk_342,ae=t.__chunk_757,ue=t.__chunk_381,se=t.__chunk_361,ie=t.__chunk_882,he=t.__chunk_937,le=t.__chunk_924,pe=t.__chunk_319,ke=t.__chunk_19,de=t.__chunk_492,fe=t.__chunk_229,ge=t.__chunk_648,be=t.__chunk_865,me=t.__chunk_299,ye=t.__chunk_716,Ee=t.__chunk_50,xe=t.__chunk_351,ve=t.__chunk_678,we=t.__chunk_440,Oe=t.__chunk_923,Ne=t.__chunk_105,Se=t.__chunk_743,Re=t.__chunk_850,Te=t.__chunk_586,je=t.__chunk_736,Ce=t.__chunk_919,Ae=t.__chunk_427,Pe=t.__chunk_560,Ie=t.__chunk_435,Fe=t.__chunk_57,Me=t.__chunk_257,Le=t.__chunk_281,Ue=t.__chunk_742,De=t.__chunk_400,$e=t.__chunk_682,qe=t.__chunk_478,Be=t.__chunk_314,Je=t.__chunk_773,Ge=t.__chunk_170,Xe=t.__chunk_811,Ke=t.__chunk_354,V=ne(T,T,T),He=V.__NEXT_FONT_MANIFEST,Ve=V.__REACT_LOADABLE_MANIFEST,Ze=((s,i,F)=>(i._ENTRIES={},s.__BUILD_MANIFEST={polyfillFiles:["static/chunks/polyfills-42372ed130431b0a.js"],devFiles:[],ampDevFiles:[],lowPriorityFiles:[],rootMainFiles:["static/chunks/webpack-9c6c184dd610cc23.js","static/chunks/5b581c49-7d04a29ef44df04e.js","static/chunks/651-fbf49f55d465baa1.js","static/chunks/main-app-84cb1012d59da1d2.js"],pages:{"/_app":["static/chunks/webpack-9c6c184dd610cc23.js","static/chunks/framework-6e06c675866dc992.js","static/chunks/main-279b610c1a32cb4f.js","static/chunks/pages/_app-8f4fb87037d1670c.js"],"/_error":["static/chunks/webpack-9c6c184dd610cc23.js","static/chunks/framework-6e06c675866dc992.js","static/chunks/main-279b610c1a32cb4f.js","static/chunks/pages/_error-6c50fc1be0ed5954.js"]},ampFirstPages:[]},s.__BUILD_MANIFEST.lowPriorityFiles=["/static/43xVRVs_yQDN4IZE4UsC_/_buildManifest.js",,"/static/43xVRVs_yQDN4IZE4UsC_/_ssgManifest.js"],s.__REACT_LOADABLE_MANIFEST=Ve,s.__NEXT_FONT_MANIFEST=He,s.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",(()=>{"use strict";var p={},k={};function r(n){var u=k[n];if(u!==void 0)return u.exports;var a=k[n]={exports:{}},d=!0;try{p[n](a,a.exports,r),d=!1}finally{d&&delete k[n]}return a.exports}r.m=p,(()=>{var n=[];r.O=(u,a,d,f)=>{if(a){f=f||0;for(var h=n.length;h>0&&n[h-1][2]>f;h--)n[h]=n[h-1];n[h]=[a,d,f];return}for(var b=1/0,h=0;h<n.length;h++){for(var[a,d,f]=n[h],x=!0,l=0;l<a.length;l++)b>=f&&Object.keys(r.O).every(I=>r.O[I](a[l]))?a.splice(l--,1):(x=!1,f<b&&(b=f));if(x){n.splice(h--,1);var N=d();N!==void 0&&(u=N)}}return u}})(),r.n=n=>{var u=n&&n.__esModule?()=>n.default:()=>n;return r.d(u,{a:u}),u},r.d=(n,u)=>{for(var a in u)r.o(u,a)&&!r.o(n,a)&&Object.defineProperty(n,a,{enumerable:!0,get:u[a]})},r.e=()=>Promise.resolve(),r.g=function(){if(typeof i=="object")return i;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),r.o=(n,u)=>Object.prototype.hasOwnProperty.call(n,u),r.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},(()=>{var n={993:0};r.O.j=d=>n[d]===0;var u=(d,f)=>{var h,b,[x,l,N]=f,S=0;if(x.some(A=>n[A]!==0)){for(h in l)r.o(l,h)&&(r.m[h]=l[h]);if(N)var M=N(r)}for(d&&d(f);S<x.length;S++)b=x[S],r.o(n,b)&&n[b]&&n[b][0](),n[b]=0;return r.O(M)},a=s.webpackChunk_N_E=s.webpackChunk_N_E||[];a.forEach(u.bind(null,0)),a.push=u.bind(null,a.push.bind(a))})()})(),(s.webpackChunk_N_E=s.webpackChunk_N_E||[]).push([[719],{354:Ke,811:Xe,170:Ge,773:Je,314:Be,478:qe,682:$e,400:De,742:Ue,281:Le,257:Me,57:Fe,435:Ie,560:Pe,427:Ae,919:Ce,736:je,586:Te,850:Re,743:Se,105:Ne,923:Oe,440:we,678:ve,351:xe,50:Ee,716:ye,299:me,865:be,648:ge,229:fe,492:de,19:ke,319:pe,924:le,937:he,882:ie,361:se,381:ue,757:ae,342:oe,388:re}]),(s.webpackChunk_N_E=s.webpackChunk_N_E||[]).push([[262],{67:ce,195:_e,72:(p,k,r)=>{"use strict";r.r(k),r.d(k,{ComponentMod:()=>B,default:()=>J});var n={};r.r(n),r.d(n,{GET:()=>N,runtime:()=>x});var u={};r.r(u),r.d(u,{originalPathname:()=>I,patchFetch:()=>q,requestAsyncStorage:()=>M,routeModule:()=>S,serverHooks:()=>P,staticGenerationAsyncStorage:()=>A});var a=r(648),d=r(351),f=r(678),h=r(716),b=r(354);let x="edge";function l(L,j=200){return new Response(JSON.stringify(L),{status:j,headers:{"Content-Type":"application/json"}})}async function N(L){let j,C,w,D=(0,b.getRequestContext)(),m=D.env?.SECRETFORGE_KV;if(!m)return l({error:"KV binding 'SECRETFORGE_KV' not found"},500);let e=new URL(L.url),o=e.searchParams.get("state"),c=e.searchParams.get("code");if(!o||!c)return l({error:"Missing 'state' or 'code'"},400);let _=await m.get(`oauth:state:${o}`);if(!_)return l({error:"Invalid or expired state"},400);try{({provider:j}=JSON.parse(_))}catch{return l({error:"Stored state is not valid JSON"},500)}let y=await m.get(`oauth:config:${j}`);if(!y)return l({error:`No config for '${j}'`},404);try{C=JSON.parse(y)}catch{return l({error:"Stored config is not valid JSON"},500)}let g=new URL(C.redirect_path||"/api/oauth/callback",e.origin).toString(),R=new URLSearchParams({client_id:C.client_id,client_secret:C.client_secret,grant_type:"authorization_code",code:c,redirect_uri:g}),O={"Content-Type":"application/x-www-form-urlencoded"};for(let[$,W]of Object.entries(C.token_headers||{}))O[$]=W;let E=await fetch(C.token_url,{method:"POST",headers:O,body:R}),v=await E.text();try{w=JSON.parse(v)}catch{w=v}return await m.delete(`oauth:state:${o}`),l({provider:j,token_response:w,status:E.status})}let S=new d.AppRouteRouteModule({definition:{kind:f.x.APP_ROUTE,page:"/api/oauth/callback/route",pathname:"/api/oauth/callback",filename:"route",bundlePath:"app/api/oauth/callback/route"},resolvedPagePath:"/Users/RemyMorgan-Jones/secretforge-ai/packages/web/app/api/oauth/callback/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:M,staticGenerationAsyncStorage:A,serverHooks:P}=S,I="/api/oauth/callback/route";function q(){return(0,h.XH)({serverHooks:P,staticGenerationAsyncStorage:A})}let B=u,J=a.a.wrap(S)}},p=>{var k=n=>p(p.s=n);p.O(0,[719],()=>k(72));var r=p.O();(i._ENTRIES=typeof i._ENTRIES>"u"?{}:i._ENTRIES)["middleware_app/api/oauth/callback/route"]=r}]),function(){let p={exports:{},loaded:!1};return function(r,n){var u=Object.create,a=Object.defineProperty,d=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,h=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty,x=e=>a(e,"__esModule",{value:!0}),l=(e,o)=>{x(e);for(var c in o)a(e,c,{get:o[c],enumerable:!0})},N=(e,o,c)=>{if(o&&typeof o=="object"||typeof o=="function")for(let _ of f(o))!b.call(e,_)&&_!=="default"&&a(e,_,{get:()=>o[_],enumerable:!(c=d(o,_))||c.enumerable});return e},S=e=>N(x(a(e!=null?u(h(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);l(n,{default:()=>C});var M=S((H(),ee(U))),A="@next/request-context",P=Symbol.for(A),I=Symbol.for("internal.storage");function q(){let e=i;if(!e[P]){let o=new M.AsyncLocalStorage,c={get:()=>o.getStore(),[I]:o};e[P]=c}return e[P]}var B=q();function J(e,o){return B[I].run(e,o)}function L(e){let o={};return e&&e.forEach((c,_)=>{o[_]=c,_.toLowerCase()==="set-cookie"&&(o[_]=j(c))}),o}function j(e){let o=[],c=0,_,y,g,R,O;function E(){for(;c<e.length&&/\s/.test(e.charAt(c));)c+=1;return c<e.length}function v(){return y=e.charAt(c),y!=="="&&y!==";"&&y!==","}for(;c<e.length;){for(_=c,O=!1;E();)if(y=e.charAt(c),y===","){for(g=c,c+=1,E(),R=c;c<e.length&&v();)c+=1;c<e.length&&e.charAt(c)==="="?(O=!0,c=R,o.push(e.substring(_,g)),_=c):c=g+1}else c+=1;(!O||c>=e.length)&&o.push(e.substring(_,e.length))}return o}function C(e){let o=e.staticRoutes.map(_=>({regexp:new RegExp(_.namedRegex),page:_.page})),c=e.dynamicRoutes?.map(_=>({regexp:new RegExp(_.namedRegex),page:_.page}))||[];return async function(_,y){let g=new URL(_.url).pathname,R={};if(e.nextConfig?.basePath&&g.startsWith(e.nextConfig.basePath)&&(g=g.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let E of e.nextConfig.i18n.locales){let v=new RegExp(`^/${E}($|/)`,"i");if(g.match(v)){g=g.replace(v,"/")||"/";break}}for(let E of o)if(E.regexp.exec(g)){R.name=E.page;break}if(!R.name){let E=D(g);for(let v of c||[]){if(E&&!D(v.page))continue;let $=v.regexp.exec(g);if($){R={name:v.page,params:$.groups};break}}}let O=await J({waitUntil:y.waitUntil},()=>i._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:_.url,method:_.method,headers:L(_.headers),ip:w(_.headers,m.Ip),geo:{city:w(_.headers,m.City,!0),country:w(_.headers,m.Country,!0),latitude:w(_.headers,m.Latitude),longitude:w(_.headers,m.Longitude),region:w(_.headers,m.Region,!0)},nextConfig:e.nextConfig,page:R,body:_.body}}));return O.waitUntil&&y.waitUntil(O.waitUntil),O.response}}function w(e,o,c=!1){let _=e.get(o)||void 0;return c&&_?decodeURIComponent(_):_}function D(e){return e==="/api"||e.startsWith("/api/")}var m;(function(e){e.City="x-vercel-ip-city",e.Country="x-vercel-ip-country",e.Ip="x-real-ip",e.Latitude="x-vercel-ip-latitude",e.Longitude="x-vercel-ip-longitude",e.Region="x-vercel-ip-country-region"})(m||(m={}))}(p,p.exports),p.exports}.call({}).default({name:"app/api/oauth/callback/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"}],dynamicRoutes:[],nextConfig:{basePath:""}})))(T,T,T);export{Ze as default};
