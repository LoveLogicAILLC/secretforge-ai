var K=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var Q=Object.prototype.hasOwnProperty;var Y=(s,i)=>()=>(s&&(i=s(s=0)),i);var G=(s,i,I,p)=>{if(i&&typeof i=="object"||typeof i=="function")for(let l of z(i))!Q.call(s,l)&&l!==I&&K(s,l,{get:()=>i[l],enumerable:!(p=W(i,l))||p.enumerable});return s},X=(s,i,I)=>(G(s,i,"default"),I&&G(I,i,"default"));var Z=s=>G(K({},"__esModule",{value:!0}),s);var U={};import*as Wt from"async_hooks";var H=Y(()=>{X(U,Wt)});import{__getNamedExports as tt}from"../../../../__next-on-pages-dist__/webpack/bdec9f97dc450b9d877b52222a283bc1.js";import{__getNamedExports as et}from"../../../../__next-on-pages-dist__/manifest/537259e2ed205f5a7994cb4f05664668.js";var N=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/oauth/start"),e=tt(N,N,N),nt=e.__chunk_195,_t=e.__chunk_67,rt=e.__chunk_388,ct=e.__chunk_342,ot=e.__chunk_757,at=e.__chunk_381,ut=e.__chunk_361,st=e.__chunk_882,it=e.__chunk_937,ht=e.__chunk_924,pt=e.__chunk_319,lt=e.__chunk_19,dt=e.__chunk_492,kt=e.__chunk_229,ft=e.__chunk_648,gt=e.__chunk_865,mt=e.__chunk_299,yt=e.__chunk_716,Et=e.__chunk_50,bt=e.__chunk_351,xt=e.__chunk_678,vt=e.__chunk_440,wt=e.__chunk_923,Ot=e.__chunk_105,Rt=e.__chunk_743,Nt=e.__chunk_850,St=e.__chunk_586,jt=e.__chunk_736,At=e.__chunk_919,Tt=e.__chunk_427,Ct=e.__chunk_560,Pt=e.__chunk_435,It=e.__chunk_57,Ft=e.__chunk_257,Mt=e.__chunk_281,Lt=e.__chunk_742,Ut=e.__chunk_400,Dt=e.__chunk_682,$t=e.__chunk_478,qt=e.__chunk_314,Bt=e.__chunk_773,Gt=e.__chunk_170,Xt=e.__chunk_811,Jt=e.__chunk_354,V=et(N,N,N),Kt=V.__NEXT_FONT_MANIFEST,Ht=V.__REACT_LOADABLE_MANIFEST,Yt=((s,i,I)=>(i._ENTRIES={},s.__BUILD_MANIFEST={polyfillFiles:["static/chunks/polyfills-42372ed130431b0a.js"],devFiles:[],ampDevFiles:[],lowPriorityFiles:[],rootMainFiles:["static/chunks/webpack-9c6c184dd610cc23.js","static/chunks/5b581c49-7d04a29ef44df04e.js","static/chunks/651-fbf49f55d465baa1.js","static/chunks/main-app-84cb1012d59da1d2.js"],pages:{"/_app":["static/chunks/webpack-9c6c184dd610cc23.js","static/chunks/framework-6e06c675866dc992.js","static/chunks/main-279b610c1a32cb4f.js","static/chunks/pages/_app-8f4fb87037d1670c.js"],"/_error":["static/chunks/webpack-9c6c184dd610cc23.js","static/chunks/framework-6e06c675866dc992.js","static/chunks/main-279b610c1a32cb4f.js","static/chunks/pages/_error-6c50fc1be0ed5954.js"]},ampFirstPages:[]},s.__BUILD_MANIFEST.lowPriorityFiles=["/static/43xVRVs_yQDN4IZE4UsC_/_buildManifest.js",,"/static/43xVRVs_yQDN4IZE4UsC_/_ssgManifest.js"],s.__REACT_LOADABLE_MANIFEST=Ht,s.__NEXT_FONT_MANIFEST=Kt,s.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",(()=>{"use strict";var p={},l={};function c(n){var u=l[n];if(u!==void 0)return u.exports;var a=l[n]={exports:{}},d=!0;try{p[n](a,a.exports,c),d=!1}finally{d&&delete l[n]}return a.exports}c.m=p,(()=>{var n=[];c.O=(u,a,d,k)=>{if(a){k=k||0;for(var h=n.length;h>0&&n[h-1][2]>k;h--)n[h]=n[h-1];n[h]=[a,d,k];return}for(var m=1/0,h=0;h<n.length;h++){for(var[a,d,k]=n[h],b=!0,f=0;f<a.length;f++)m>=k&&Object.keys(c.O).every(P=>c.O[P](a[f]))?a.splice(f--,1):(b=!1,k<m&&(m=k));if(b){n.splice(h--,1);var w=d();w!==void 0&&(u=w)}}return u}})(),c.n=n=>{var u=n&&n.__esModule?()=>n.default:()=>n;return c.d(u,{a:u}),u},c.d=(n,u)=>{for(var a in u)c.o(u,a)&&!c.o(n,a)&&Object.defineProperty(n,a,{enumerable:!0,get:u[a]})},c.e=()=>Promise.resolve(),c.g=function(){if(typeof i=="object")return i;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),c.o=(n,u)=>Object.prototype.hasOwnProperty.call(n,u),c.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},(()=>{var n={993:0};c.O.j=d=>n[d]===0;var u=(d,k)=>{var h,m,[b,f,w]=k,O=0;if(b.some(T=>n[T]!==0)){for(h in f)c.o(f,h)&&(c.m[h]=f[h]);if(w)var F=w(c)}for(d&&d(k);O<b.length;O++)m=b[O],c.o(n,m)&&n[m]&&n[m][0](),n[m]=0;return c.O(F)},a=s.webpackChunk_N_E=s.webpackChunk_N_E||[];a.forEach(u.bind(null,0)),a.push=u.bind(null,a.push.bind(a))})()})(),(s.webpackChunk_N_E=s.webpackChunk_N_E||[]).push([[719],{354:Jt,811:Xt,170:Gt,773:Bt,314:qt,478:$t,682:Dt,400:Ut,742:Lt,281:Mt,257:Ft,57:It,435:Pt,560:Ct,427:Tt,919:At,736:jt,586:St,850:Nt,743:Rt,105:Ot,923:wt,440:vt,678:xt,351:bt,50:Et,716:yt,299:mt,865:gt,648:ft,229:kt,492:dt,19:lt,319:pt,924:ht,937:it,882:st,361:ut,381:at,757:ot,342:ct,388:rt}]),(s.webpackChunk_N_E=s.webpackChunk_N_E||[]).push([[257],{67:_t,195:nt,653:(p,l,c)=>{"use strict";c.r(l),c.d(l,{ComponentMod:()=>$,default:()=>q});var n={};c.r(n),c.d(n,{GET:()=>w,runtime:()=>b});var u={};c.r(u),c.d(u,{originalPathname:()=>P,patchFetch:()=>D,requestAsyncStorage:()=>F,routeModule:()=>O,serverHooks:()=>C,staticGenerationAsyncStorage:()=>T});var a=c(648),d=c(351),k=c(678),h=c(716),m=c(354);let b="edge";function f(M,y=200){return new Response(JSON.stringify(M),{status:y,headers:{"Content-Type":"application/json"}})}async function w(M){let y,B=(0,m.getRequestContext)(),v=B.env?.SECRETFORGE_KV;if(!v)return f({error:"KV binding 'SECRETFORGE_KV' not found"},500);let L=new URL(M.url),E=L.searchParams.get("provider");if(!E)return f({error:"Missing 'provider'"},400);let t=await v.get(`oauth:config:${E}`);if(!t)return f({error:`No config for '${E}'`},404);try{y=JSON.parse(t)}catch{return f({error:"Stored config is not valid JSON"},500)}let o=crypto.randomUUID(),r=new URL(y.redirect_path||"/api/oauth/callback",L.origin).toString();await v.put(`oauth:state:${o}`,JSON.stringify({provider:E,createdAt:Date.now()}),{expirationTtl:600});let _=new URLSearchParams({client_id:y.client_id,redirect_uri:r,response_type:"code",state:o});if(y.scopes?.length&&_.set("scope",y.scopes.join(" ")),y.extra_params)for(let[x,g]of Object.entries(y.extra_params))_.set(x,g);return new Response(null,{status:302,headers:{Location:`${y.authorize_url}${y.authorize_url.includes("?")?"&":"?"}${_.toString()}`}})}let O=new d.AppRouteRouteModule({definition:{kind:k.x.APP_ROUTE,page:"/api/oauth/start/route",pathname:"/api/oauth/start",filename:"route",bundlePath:"app/api/oauth/start/route"},resolvedPagePath:"/Users/RemyMorgan-Jones/secretforge-ai/packages/web/app/api/oauth/start/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:F,staticGenerationAsyncStorage:T,serverHooks:C}=O,P="/api/oauth/start/route";function D(){return(0,h.XH)({serverHooks:C,staticGenerationAsyncStorage:T})}let $=u,q=a.a.wrap(O)}},p=>{var l=n=>p(p.s=n);p.O(0,[719],()=>l(653));var c=p.O();(i._ENTRIES=typeof i._ENTRIES>"u"?{}:i._ENTRIES)["middleware_app/api/oauth/start/route"]=c}]),function(){let p={exports:{},loaded:!1};return function(c,n){var u=Object.create,a=Object.defineProperty,d=Object.getOwnPropertyDescriptor,k=Object.getOwnPropertyNames,h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty,b=t=>a(t,"__esModule",{value:!0}),f=(t,o)=>{b(t);for(var r in o)a(t,r,{get:o[r],enumerable:!0})},w=(t,o,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let _ of k(o))!m.call(t,_)&&_!=="default"&&a(t,_,{get:()=>o[_],enumerable:!(r=d(o,_))||r.enumerable});return t},O=t=>w(b(a(t!=null?u(h(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);f(n,{default:()=>B});var F=O((H(),Z(U))),T="@next/request-context",C=Symbol.for(T),P=Symbol.for("internal.storage");function D(){let t=i;if(!t[C]){let o=new F.AsyncLocalStorage,r={get:()=>o.getStore(),[P]:o};t[C]=r}return t[C]}var $=D();function q(t,o){return $[P].run(t,o)}function M(t){let o={};return t&&t.forEach((r,_)=>{o[_]=r,_.toLowerCase()==="set-cookie"&&(o[_]=y(r))}),o}function y(t){let o=[],r=0,_,x,g,j,A;function R(){for(;r<t.length&&/\s/.test(t.charAt(r));)r+=1;return r<t.length}function S(){return x=t.charAt(r),x!=="="&&x!==";"&&x!==","}for(;r<t.length;){for(_=r,A=!1;R();)if(x=t.charAt(r),x===","){for(g=r,r+=1,R(),j=r;r<t.length&&S();)r+=1;r<t.length&&t.charAt(r)==="="?(A=!0,r=j,o.push(t.substring(_,g)),_=r):r=g+1}else r+=1;(!A||r>=t.length)&&o.push(t.substring(_,t.length))}return o}function B(t){let o=t.staticRoutes.map(_=>({regexp:new RegExp(_.namedRegex),page:_.page})),r=t.dynamicRoutes?.map(_=>({regexp:new RegExp(_.namedRegex),page:_.page}))||[];return async function(_,x){let g=new URL(_.url).pathname,j={};if(t.nextConfig?.basePath&&g.startsWith(t.nextConfig.basePath)&&(g=g.replace(t.nextConfig.basePath,"")||"/"),t.nextConfig?.i18n)for(let R of t.nextConfig.i18n.locales){let S=new RegExp(`^/${R}($|/)`,"i");if(g.match(S)){g=g.replace(S,"/")||"/";break}}for(let R of o)if(R.regexp.exec(g)){j.name=R.page;break}if(!j.name){let R=L(g);for(let S of r||[]){if(R&&!L(S.page))continue;let J=S.regexp.exec(g);if(J){j={name:S.page,params:J.groups};break}}}let A=await q({waitUntil:x.waitUntil},()=>i._ENTRIES[`middleware_${t.name}`].default.call({},{request:{url:_.url,method:_.method,headers:M(_.headers),ip:v(_.headers,E.Ip),geo:{city:v(_.headers,E.City,!0),country:v(_.headers,E.Country,!0),latitude:v(_.headers,E.Latitude),longitude:v(_.headers,E.Longitude),region:v(_.headers,E.Region,!0)},nextConfig:t.nextConfig,page:j,body:_.body}}));return A.waitUntil&&x.waitUntil(A.waitUntil),A.response}}function v(t,o,r=!1){let _=t.get(o)||void 0;return r&&_?decodeURIComponent(_):_}function L(t){return t==="/api"||t.startsWith("/api/")}var E;(function(t){t.City="x-vercel-ip-city",t.Country="x-vercel-ip-country",t.Ip="x-real-ip",t.Latitude="x-vercel-ip-latitude",t.Longitude="x-vercel-ip-longitude",t.Region="x-vercel-ip-country-region"})(E||(E={}))}(p,p.exports),p.exports}.call({}).default({name:"app/api/oauth/start/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"}],dynamicRoutes:[],nextConfig:{basePath:""}})))(N,N,N);export{Yt as default};
