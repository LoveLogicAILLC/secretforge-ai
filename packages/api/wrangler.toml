name = "secretforge-api"
main = "src/index.ts"
compatibility_date = "2024-09-23"
node_compat = true

[observability]
enabled = true

# D1 Database for metadata
[[d1_databases]]
binding = "DATABASE"
database_name = "secretforge-db"
database_id = "YOUR_D1_DATABASE_ID"

# KV for encrypted secrets storage
[[kv_namespaces]]
binding = "SECRETS_VAULT"
id = "YOUR_KV_NAMESPACE_ID"

# KV for rate limiting
[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "YOUR_RATE_LIMIT_KV_ID"

# Vectorize for API documentation search
[[vectorize]]
binding = "VECTOR_DB"
index_name = "api-docs-index"

# Hyperdrive for PostgreSQL connections (optional)
[[hyperdrive]]
binding = "HYPERDRIVE"
id = "YOUR_HYPERDRIVE_ID"

# Agents for stateful AI workflows
[[agents]]
binding = "SECRET_AGENT"
name = "secret-agent"

[vars]
ENVIRONMENT = "development"

# Secrets (set via wrangler secret put)
# OPENAI_API_KEY
# ANTHROPIC_API_KEY
# ENCRYPTION_KEY (32 bytes base64)
# JWT_SECRET (32+ bytes base64)
# API_KEY_SALT (32 bytes base64)

[env.production]
name = "secretforge-api-production"

[env.production.vars]
ENVIRONMENT = "production"

[build]
command = "pnpm build"

[dev]
port = 8787
